name: Find Python Projects
description: Discover Python projects in a repository and expose helpful things from pyproject.toml to other steps
author: brandonlwhite@gmail.com
branding:
  icon: search
  color: blue

inputs:
  root-dir:
    description: Directory root for where to begin recursively searching for projects.  Python projects contained in this directory or lower will be discovered.
    required: false
    default: "."
  additional-export-paths:
    description: Additional TOML keys to export as part of the projects object. Specify them as json path strings, separated by commas. For example, "tool.upside.foo,bar.baz".
    required: false
    default: ""
  exclude-commands:
    description: |
      Commands to exclude from being exported as part of the projects.

      These excludes can be specified either as a string that will apply the exclude globally, or as multiple key-value pairs for certain projects.

      For example, passing the string "test" will not export a detected test command from ANY project in the repo.

      To exclude a command only from a certain project in the repo, use "project=" and "command=". For example, specifying the following:

        exclude-commands: |
          project=my-package-1,command=test
          project=my-package-2,command=lint
          project=my-package-1,command=install

      would not export the "test" and "install" commands for "my-package-1" and the "lint" command for "my-package-2".

      Mixing global and project-level excludes is valid.
    required: false
    default: ""

outputs:
  paths:
    description: JSON array of found project path strings

  projects:
    description: JSON array of all found projects (`project` object)

  testable-projects:
    description: JSON array of all found projects (`project` object) that implement a `test` command

  packageable-projects:
    description: JSON array of all found projects (`project` object) that implement a `package` command

runs:
  using: "node20"
  main: "dist/index.js"
